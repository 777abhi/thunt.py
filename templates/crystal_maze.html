{% extends "layout.html" %}
{% block content %}
<div class="row center-align">
  <div class="col s12">
      <div class="card amber lighten-4">
        <div class="card-content">
          <span class="card-title"><h2>Socket Gate</h2></span>
          <div class="row">
            <div class="col s1 center-align"></div>
            <div class="col s5 center-align">
              <div class="row">
                <div class="col s12 center-align">
                  <a class="btn" onclick="up();"><i class="large material-icons">arrow_upward</i></a>
                </div>
              </div>
              <div class="row">
                <div class="col s12 center-align">
                <a class="btn" onclick="left();"><i class="large material-icons">arrow_back</i></a>
                  <a class="btn" onclick="down();"><i class="large material-icons">arrow_downward</i></a>
                  <a class="btn" onclick="right();"><i class="large material-icons">arrow_forward</i></a>
                </div>
              </div>
              <div class="row">
                <div class="col s12 center-align">
                  <form id="crystalMazeForm" name="crystalMazeForm" action="/r/crystal_maze" method="POST">
                    <input type="hidden" id="crystalMazePath" name="crystalMazePath"></input>
                  </form>
                  <button id="crystalMazeFormSubmit" class="btn">Submit</button>
                </div>
              </div>
            </div>
            <div class="col s5 center-align">
              <table id="maze" class="striped">
              </table>
            </div>
            <div class="col s1 center-align"></div>
          </div>
        </div>
      </div>
    </div>
</div>
<script>
  var data = [
        [0,0,0,0,0,0,0,0,0,0,0,0],
        [0,1,1,1,1,1,1,1,1,1,1,0],
        [4,2,2,1,2,1,1,1,1,2,1,0],
        [0,1,2,1,2,2,2,2,2,2,1,0],
        [0,1,2,2,2,1,1,2,1,1,1,0],
        [0,1,1,1,1,1,2,2,1,1,1,0],
        [0,1,1,2,2,2,2,1,1,2,2,2],
        [0,1,2,2,1,1,1,1,2,2,1,0],
        [0,1,2,1,1,1,1,1,2,1,1,0],
        [0,1,2,2,2,2,2,2,2,2,1,0],
        [0,1,1,1,1,1,1,1,1,1,1,0],
        [0,0,0,0,0,0,0,0,0,0,0,0]
      ];
  var direction = "";

  $(document).ready(function(){
      fillMaze(data);
    });

  function fillMaze(data){
          y = 0;
          data.forEach(function(row){
              tr = "<tr>";
              x = 0;
              row.forEach(function(cell){
                  tr += "<td class='x"+x+" y"+y+" ";
                  if(cell == 1){
                      tr += "black";
                  }else if (cell == 2){
                      tr += "blue-grey";
                  }else if(cell == 3){
                      tr += "green";
                  }else if(cell == 4){
                      tr += "deep-purple";
                  }
                  tr += "'></td>";
                  x+=1;
                });
                tr += "</tr>";
                $("#maze").append(tr);
                y+=1;
            });
    }

  function right(){
      currentElm = $(".deep-purple")[0];
      newElm = $(".x"+(currentPosX()+1) + ".y" + currentPosY());
      if(newElm.hasClass("blue-grey")){
          $(newElm).removeClass("blue-grey");
          $(newElm).addClass("deep-purple");
          $(currentElm).removeClass("deep-purple");
          $(currentElm).addClass("blue-grey");
        }
      direction += "r";
    }
  function left(){
      currentElm = $(".deep-purple")[0];
      newElm = $(".x"+(currentPosX()-1) + ".y" + currentPosY());
      if(newElm.hasClass("blue-grey")){
          $(newElm).removeClass("blue-grey");
          $(newElm).addClass("deep-purple");
          $(currentElm).removeClass("deep-purple");
          $(currentElm).addClass("blue-grey");
        }
      direction += "l";
    }
  function up(){
      currentElm = $(".deep-purple")[0];
      newElm = $(".x"+currentPosX() + ".y" + (currentPosY()-1));
      if(newElm.hasClass("blue-grey")){
          $(newElm).removeClass("blue-grey");
          $(newElm).addClass("deep-purple");
          $(currentElm).removeClass("deep-purple");
          $(currentElm).addClass("blue-grey");
        }
      direction += "u";
    }
  function down(){
      currentElm = $(".deep-purple")[0];
      newElm = $(".x"+currentPosX() + ".y" + (currentPosY()+1));
      if(newElm.hasClass("blue-grey")){
          $(newElm).removeClass("blue-grey");
          $(newElm).addClass("deep-purple");
          $(currentElm).removeClass("deep-purple");
          $(currentElm).addClass("blue-grey");
        }
      direction += "d";
    }
  function currentPos(){
      var classes = $(".deep-purple").attr("class").split(/\s+/);
      var x = parseInt(classes.find(el => el.startsWith("x")).replace("x", ""));
      var y = parseInt(classes.find(el => el.startsWith("y")).replace("y", ""));
      return [x,y]
    }
  function currentPosX(){
      return currentPos()[0];
  }
  function currentPosY(){
      return currentPos()[1];
  }

  document.getElementById("crystalMazeFormSubmit").onclick = function(){
      document.getElementById("crystalMazePath").value = direction;
      if($(".x11.y6").hasClass("deep-purple")){
          document.getElementById("crystalMazeForm").submit();
        }
    }
</script>
{% endblock %}
